<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Salami from Aunik & Mahdi - ржИржж ржорзБржмрж╛рж░ржХ</title>
  <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&family=Poppins:wght@400;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: url('https://i.postimg.cc/PrkjByDm/1000052691.jpg') no-repeat center center/cover;
      background-attachment: fixed;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
      color: white;
      font-family: 'Poppins', sans-serif;
      position: relative;
      overflow-x: hidden;
    }
    
    /* Overlay for better text readability */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
      z-index: 0;
      pointer-events: none;
    }

    /* Eid decorative elements */
    .moon-stars {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 60px;
      opacity: 0.3;
      animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    .mosque-silhouette {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 120px;
      background: rgba(0, 0, 0, 0.3);
      clip-path: polygon(
        0 100%, 0 70%,
        20% 50%, 25% 70%,
        45% 30%, 50% 70%,
        75% 50%, 80% 70%,
        100% 70%, 100% 100%
      );
      z-index: 0;
      backdrop-filter: blur(5px);
    }

    h1, h2, h3, .btn, input::placeholder, .duwa-text {
      font-family: 'Hind Siliguri', 'Poppins', sans-serif;
    }

    .arabic-text {
      font-family: 'Amiri', serif;
      font-size: 20px;
      line-height: 1.8;
      direction: rtl;
    }

    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #f0f;
      position: absolute;
      animation: confetti-fall 3s linear infinite;
      z-index: 1000;
    }

    @keyframes confetti-fall {
      to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }

    .container {
      background: rgba(0, 0, 0, 0.7);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
      max-width: 500px;
      width: 90%;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.5s ease;
      position: relative;
      z-index: 1;
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .eid-badge {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      padding: 8px 20px;
      border-radius: 20px;
      display: inline-block;
      margin-bottom: 15px;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
    }

    h1 {
      font-size: 26px;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    .subtitle {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 20px;
    }

    h2 {
      font-size: 22px;
      margin-bottom: 15px;
      animation: bounce 0.6s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    input {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: 2px solid #ffd700;
      border-radius: 8px;
      text-align: center;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.95);
      transition: all 0.3s ease;
    }

    input:focus {
      outline: none;
      border-color: #ffa500;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
      transform: scale(1.02);
    }

    .btn {
      display: inline-block;
      margin: 15px 5px 0;
      padding: 12px 25px;
      font-size: 18px;
      font-weight: bold;
      color: white;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary:hover:not(:disabled) {
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn-download {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      box-shadow: 0 4px 15px rgba(56, 239, 125, 0.4);
    }

    .btn-download:hover:not(:disabled) {
      box-shadow: 0 6px 20px rgba(56, 239, 125, 0.6);
    }

    .bill-image {
      width: 100%;
      max-width: 280px;
      margin-top: 20px;
      border-radius: 12px;
      box-shadow: 0px 0px 25px rgba(255, 215, 0, 0.4);
      animation: slideIn 0.5s ease;
      border: 3px solid rgba(255, 215, 0, 0.3);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .duwa-card {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
      border-radius: 15px;
      border: 2px solid rgba(255, 215, 0, 0.4);
      animation: glow 2s infinite;
    }

    @keyframes glow {
      0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
      50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
    }

    .duwa-title {
      font-size: 18px;
      font-weight: bold;
      color: #ffd700;
      margin-bottom: 10px;
    }

    .duwa-text {
      font-size: 16px;
      line-height: 1.6;
      color: #fff;
      margin-bottom: 10px;
    }

    .history {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      max-height: 250px;
      overflow-y: auto;
    }

    .history-item {
      padding: 8px;
      margin: 5px 0;
      background: rgba(255, 215, 0, 0.2);
      border-radius: 5px;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .history-item .name {
      font-weight: 600;
      color: #ffd700;
    }

    .history-item .time {
      font-size: 12px;
      opacity: 0.8;
    }

    .counter {
      margin-top: 15px;
      font-size: 18px;
      color: #ffd700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      font-weight: bold;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      background: rgba(255, 71, 87, 0.3);
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 14px;
      color: #ff7675;
      border: 1px solid rgba(255, 71, 87, 0.5);
    }

    .hidden {
      display: none;
    }

    .footer {
      position: fixed;
      bottom: 10px;
      width: 100%;
      text-align: center;
      font-size: 14px;
      opacity: 0.7;
      z-index: 1;
    }

    .footer a {
      color: #ffd700;
      text-decoration: none;
      font-weight: bold;
      transition: color 0.3s ease;
    }

    .footer a:hover {
      color: #ffa500;
      text-decoration: underline;
    }

    .history::-webkit-scrollbar {
      width: 8px;
    }

    .history::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }

    .history::-webkit-scrollbar-thumb {
      background: #ffd700;
      border-radius: 10px;
    }

    .live-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #00ff00;
      border-radius: 50%;
      margin-left: 8px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Download card canvas styling */
    #downloadCanvas {
      display: none;
    }

    .preview-card {
      margin-top: 15px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      border: 1px dashed rgba(255, 215, 0, 0.5);
    }

    .preview-text {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

  <!-- Decorative elements -->
  <div class="moon-stars">ЁЯМЩтЬи</div>
  <div class="mosque-silhouette"></div>

  <!-- Initial Input Section -->
  <div class="container" id="initialContainer">
    <div class="eid-badge">ЁЯМЩ ржИржж ржорзБржмрж╛рж░ржХ ЁЯМЩ</div>
    <h1>ЁЯОБ ржЖржкржирж┐ ржЕржирзАржХрзЗрж░ / ржорж╛рж╣ржжрзАрж░ ржХрзЗ? ЁЯОБ</h1>
    <p class="subtitle">рж╕рж╛рж▓рж╛ржорзА ржкрж╛ржУржпрж╝рж╛рж░ ржЬржирзНржп ржЖржкржирж╛рж░ ржирж╛ржо рж▓рж┐ржЦрзБржи</p>
    <input type="text" id="userName" placeholder="ржЖржкржирж╛рж░ ржирж╛ржо рж▓рж┐ржЦрзБржи" maxlength="50">
    <br>
    <button class="btn" id="receiveBtn">ЁЯОЙ рж╕рж╛рж▓рж╛ржорзА ржирж┐ржи</button>
    
    <div class="counter" id="globalCounter">
      <span class="loading"></span> Loading...
    </div>

    <div class="history hidden" id="historySection">
      <h3 style="margin-bottom: 10px; font-size: 16px;">
        ЁЯУЬ рж╕рж╛ржорзНржкрзНрж░рждрж┐ржХ ржкрзНрж░рж╛ржкржХржЧржг<span class="live-indicator"></span>
      </h3>
      <div id="historyList"></div>
    </div>

    <div id="errorDisplay" class="error hidden"></div>
  </div>

  <!-- Result Section (Initially Hidden) -->
  <div class="container hidden" id="resultContainer">
    <div class="eid-badge">ЁЯМЩ ржИржж ржорзБржмрж╛рж░ржХ ЁЯМЩ</div>
    <h2 id="resultMessage"></h2>
    <img id="billImage" class="bill-image" alt="Bangladeshi Note">
    
    <!-- Duwa Card -->
    <div class="duwa-card">
      <div class="duwa-title">ЁЯд▓ ржЖржкржирж╛рж░ ржЬржирзНржп ржжрзЛржпрж╝рж╛</div>
      <div class="arabic-text" id="duwaArabic"></div>
      <div class="duwa-text" id="duwaBangla"></div>
    </div>

    <div class="counter" id="counter"></div>
    
    <div style="margin-top: 20px;">
      <button class="btn btn-download" id="downloadBtn">ЁЯУе ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи</button>
      <button class="btn" id="shareBtn">ЁЯУд рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи</button>
      <button class="btn btn-secondary" id="tryAgainBtn">ЁЯФД ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи</button>
    </div>

    <div class="preview-card">
      <div class="preview-text">ржбрж╛ржЙржирж▓рзЛржб ржХрж░рж▓рзЗ ржПржХржЯрж┐ рж╕рзБржирзНржжрж░ ржИржж ржХрж╛рж░рзНржб ржкрж╛ржмрзЗржи ЁЯОи</div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <a href="https://github.com/mehedyk" target="_blank">A @mehedyk product</a> | Made with тЭдя╕П in Bangladesh
  </div>

  <!-- Hidden canvas for download -->
  <canvas id="downloadCanvas"></canvas>

  <script>
    // Session ID for tracking
    const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

    // Bill images
    const billImages = [
      "https://i.postimg.cc/yxZV71CL/60ef0539dd7292-86085694-original.jpg",
      "https://i.postimg.cc/c4v38w0z/626c27fbbd8e42-21585521-original.jpg",
      "https://i.postimg.cc/j2sXb5fb/62ca85a360eaa8-54197328-original.jpg",
      "https://i.postimg.cc/zGSGLGbM/6378960701c077-24377127-original.jpg",
      "https://i.postimg.cc/fRhbT9Lm/63fdf6608215d0-47811604-original.jpg",
      "https://i.postimg.cc/4d8KYNMZ/64512e545596f1-49423818-original.jpg",
      "https://i.postimg.cc/Gm048fMB/64512fd6d9b187-62282441-original-1.jpg",
      "https://i.postimg.cc/cJx4fGfJ/645141f718c5e3-53349676-original.jpg",
      "https://i.postimg.cc/cCpL3Kcq/64514377647a05-37023358-original.jpg"
    ];

    // Duwa collection (Bengali Islamic prayers)
    const duwaCollection = [
      {
        arabic: "╪и┘О╪з╪▒┘О┘Г┘О ╪з┘Д┘Д┘О┘С┘З┘П ┘Д┘О┘Г┘О ┘И┘О╪и┘О╪з╪▒┘О┘Г┘О ╪╣┘О┘Д┘О┘К┘Т┘Г┘О ┘И┘О╪м┘О┘Е┘О╪╣┘О ╪и┘О┘К┘Т┘Ж┘О┘Г┘П┘Е┘О╪з ┘Б┘Р┘К ╪о┘О┘К┘Т╪▒┘Н",
        bangla: "ржЖрж▓рзНрж▓рж╛рж╣ ржЖржкржирж╛ржХрзЗ ржмрж░ржХржд ржжрж╛ржи ржХрж░рзБржи ржПржмржВ ржЖржкржирж╛рж░ ржЙржкрж░ ржмрж░ржХржд ржирж╛ржЬрж┐рж▓ ржХрж░рзБржи ржПржмржВ ржЖржкржирж╛ржжрзЗрж░ ржорж╛ржЭрзЗ ржХрж▓рзНржпрж╛ржгрзЗ ржПржХрждрзНрж░рж┐ржд ржХрж░рзБржиред"
      },
      {
        arabic: "╪з┘Д┘Д┘О┘С┘З┘П┘Е┘О┘С ╪е┘Р┘Ж┘Р┘С┘К ╪г┘О╪│┘Т╪г┘О┘Д┘П┘Г┘О ╪з┘Д┘Т┘З┘П╪п┘О┘Й ┘И┘О╪з┘Д╪к┘П┘С┘В┘О┘Й ┘И┘О╪з┘Д┘Т╪╣┘О┘Б┘О╪з┘Б┘О ┘И┘О╪з┘Д┘Т╪║┘Р┘Ж┘О┘Й",
        bangla: "рж╣рзЗ ржЖрж▓рзНрж▓рж╛рж╣! ржЖржорж┐ ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ рж╣рж┐ржжрж╛ржпрж╝рж╛ржд, рждрж╛ржХржУржпрж╝рж╛, ржкржмрж┐рждрзНрж░рждрж╛ ржУ рж╕ржЪрзНржЫрж▓рждрж╛ ржкрзНрж░рж╛рж░рзНржержирж╛ ржХрж░рж┐ред"
      },
      {
        arabic: "╪▒┘О╪и┘О┘С┘Ж┘О╪з ╪в╪к┘Р┘Ж┘О╪з ┘Б┘Р┘К ╪з┘Д╪п┘П┘С┘Ж┘Т┘К┘О╪з ╪н┘О╪│┘О┘Ж┘О╪й┘Л ┘И┘О┘Б┘Р┘К ╪з┘Д┘Т╪в╪о┘Р╪▒┘О╪й┘Р ╪н┘О╪│┘О┘Ж┘О╪й┘Л ┘И┘О┘В┘Р┘Ж┘О╪з ╪╣┘О╪░┘О╪з╪и┘О ╪з┘Д┘Ж┘О┘С╪з╪▒┘Р",
        bangla: "рж╣рзЗ ржЖржорж╛ржжрзЗрж░ ржкрзНрж░рждрж┐ржкрж╛рж▓ржХ! ржЖржорж╛ржжрзЗрж░ржХрзЗ ржжрзБржирж┐ржпрж╝рж╛рждрзЗ ржХрж▓рзНржпрж╛ржг ржжрж╛ржи ржХрж░рзБржи ржПржмржВ ржЖржЦрж┐рж░рж╛рждрзЗржУ ржХрж▓рзНржпрж╛ржг ржжрж╛ржи ржХрж░рзБржи ржПржмржВ ржЖржорж╛ржжрзЗрж░ржХрзЗ ржЬрж╛рж╣рж╛ржирзНржирж╛ржорзЗрж░ ржЖржЧрзБржи ржерзЗржХрзЗ рж░ржХрзНрж╖рж╛ ржХрж░рзБржиред"
      },
      {
        arabic: "╪з┘Д┘Д┘О┘С┘З┘П┘Е┘О┘С ╪е┘Р┘Ж┘О┘С┘Г┘О ╪╣┘О┘Б┘П┘И┘М┘С ╪к┘П╪н┘Р╪и┘П┘С ╪з┘Д┘Т╪╣┘О┘Б┘Т┘И┘О ┘Б┘О╪з╪╣┘Т┘Б┘П ╪╣┘О┘Ж┘Р┘С┘К",
        bangla: "рж╣рзЗ ржЖрж▓рзНрж▓рж╛рж╣! ржирж┐рж╢рзНржЪржпрж╝ржЗ ржЖржкржирж┐ ржХрзНрж╖ржорж╛рж╢рзАрж▓, ржХрзНрж╖ржорж╛ ржХрж░рждрзЗ ржнрж╛рж▓рзЛржмрж╛рж╕рзЗржиред рждрж╛ржЗ ржЖржорж╛ржХрзЗ ржХрзНрж╖ржорж╛ ржХрж░рзЗ ржжрж┐ржиред"
      },
      {
        arabic: "╪▒┘О╪и┘Р┘С ╪з╪┤┘Т╪▒┘О╪н┘Т ┘Д┘Р┘К ╪╡┘О╪п┘Т╪▒┘Р┘К ┘И┘О┘К┘О╪│┘Р┘С╪▒┘Т ┘Д┘Р┘К ╪г┘О┘Е┘Т╪▒┘Р┘К",
        bangla: "рж╣рзЗ ржЖржорж╛рж░ ржкрзНрж░рждрж┐ржкрж╛рж▓ржХ! ржЖржорж╛рж░ рж╣рзГржжржпрж╝ ржкрзНрж░рж╢рж╕рзНржд ржХрж░рзЗ ржжрж┐ржи ржПржмржВ ржЖржорж╛рж░ ржХрж╛ржЬ рж╕рж╣ржЬ ржХрж░рзЗ ржжрж┐ржиред"
      },
      {
        arabic: "╪з┘Д┘Д┘О┘С┘З┘П┘Е┘О┘С ╪е┘Р┘Ж┘Р┘С┘К ╪г┘О╪╣┘П┘И╪░┘П ╪и┘Р┘Г┘О ┘Е┘Р┘Ж┘О ╪з┘Д┘Т┘З┘О┘Е┘Р┘С ┘И┘О╪з┘Д┘Т╪н┘О╪▓┘О┘Ж┘Р",
        bangla: "рж╣рзЗ ржЖрж▓рзНрж▓рж╛рж╣! ржЖржорж┐ ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржжрзБрж╢рзНржЪрж┐ржирзНрждрж╛ ржУ ржжрзБржГржЦ ржерзЗржХрзЗ ржЖрж╢рзНрж░ржпрж╝ ржЪрж╛ржЗред"
      },
      {
        arabic: "╪▒┘О╪и┘О┘С┘Ж┘О╪з ╪к┘О┘В┘О╪и┘О┘С┘Д┘Т ┘Е┘Р┘Ж┘О┘С╪з ╪е┘Р┘Ж┘О┘С┘Г┘О ╪г┘О┘Ж╪к┘О ╪з┘Д╪│┘О┘С┘Е┘Р┘К╪╣┘П ╪з┘Д┘Т╪╣┘О┘Д┘Р┘К┘Е┘П",
        bangla: "рж╣рзЗ ржЖржорж╛ржжрзЗрж░ ржкрзНрж░рждрж┐ржкрж╛рж▓ржХ! ржЖржорж╛ржжрзЗрж░ ржерзЗржХрзЗ ржХржмрзБрж▓ ржХрж░рзБржиред ржирж┐рж╢рзНржЪржпрж╝ржЗ ржЖржкржирж┐ рж╕рж░рзНржмрж╢рзНрж░рзЛрждрж╛, рж╕рж░рзНржмржЬрзНржЮрж╛ржирзАред"
      },
      {
        arabic: "╪з┘Д┘Д┘О┘С┘З┘П┘Е┘О┘С ╪е┘Р┘Ж┘Р┘С┘К ╪г┘О╪│┘Т╪г┘О┘Д┘П┘Г┘О ╪╣┘Р┘Д┘Т┘Е┘Л╪з ┘Ж┘О╪з┘Б┘Р╪╣┘Л╪з ┘И┘О╪▒┘Р╪▓┘Т┘В┘Л╪з ╪╖┘О┘К┘Р┘С╪и┘Л╪з ┘И┘О╪╣┘О┘Е┘О┘Д┘Л╪з ┘Е┘П╪к┘О┘В┘О╪и┘О┘С┘Д┘Л╪з",
        bangla: "рж╣рзЗ ржЖрж▓рзНрж▓рж╛рж╣! ржЖржорж┐ ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржЙржкржХрж╛рж░рзА ржЬрзНржЮрж╛ржи, ржкржмрж┐рждрзНрж░ рж░рж┐ржпрж┐ржХ ржПржмржВ ржХржмрзБрж▓ржпрзЛржЧрзНржп ржЖржорж▓ ржкрзНрж░рж╛рж░рзНржержирж╛ ржХрж░рж┐ред"
      }
    ];

    let currentDuwa = null;
    let currentBillImage = null;
    let currentUserName = '';

    // Format time ago
    function timeAgo(date) {
      const seconds = Math.floor((new Date() - new Date(date)) / 1000);
      
      if (seconds < 60) return 'ржПржЦржиржЗ';
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return minutes + ' ржорж┐ржирж┐ржЯ ржЖржЧрзЗ';
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return hours + ' ржШржгрзНржЯрж╛ ржЖржЧрзЗ';
      const days = Math.floor(hours / 24);
      return days + ' ржжрж┐ржи ржЖржЧрзЗ';
    }

    // Show error message
    function showError(message) {
      const errorDiv = document.getElementById('errorDisplay');
      errorDiv.textContent = 'тЭМ ' + message;
      errorDiv.classList.remove('hidden');
      setTimeout(() => errorDiv.classList.add('hidden'), 5000);
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Validate name
    function validateName(name) {
      if (!name || name.trim().length < 2) {
        return { valid: false, error: 'ржирж╛ржо ржЕржирзНрждржд рзи ржЕржХрзНрж╖рж░рзЗрж░ рж╣рждрзЗ рж╣ржмрзЗ' };
      }
      
      if (name.length > 50) {
        return { valid: false, error: 'ржирж╛ржо рж╕рж░рзНржмрзЛржЪрзНржЪ рзлрзж ржЕржХрзНрж╖рж░рзЗрж░ рж╣рждрзЗ ржкрж╛рж░рзЗ' };
      }

      return { valid: true };
    }

    // Load history (mock function - replace with your Netlify function call)
    async function loadHistory() {
      // This would call your Netlify function
      // For now, just showing the counter
      document.getElementById('globalCounter').innerHTML = 
        `ЁЯОЙ ржорзЛржЯ рж╕рж╛рж▓рж╛ржорзА ржкрзНрж░ржжрж╛ржи: <strong>Loading...</strong>`;
    }

    // Save salami (mock function - replace with your Netlify function call)
    async function saveSalami(name) {
      // This would call your Netlify function
      return true;
    }

    // Create confetti
    function createConfetti() {
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.background = ['#ffd700', '#ff69b4', '#00ff00', '#00ffff', '#ff00ff'][Math.floor(Math.random() * 5)];
          confetti.style.animationDelay = Math.random() * 2 + 's';
          confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
          document.body.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
      }
    }

    // Generate downloadable card
    async function generateDownloadCard() {
      const canvas = document.getElementById('downloadCanvas');
      const ctx = canvas.getContext('2d');
      
      // Set canvas size
      canvas.width = 800;
      canvas.height = 1200;

      // Background gradient
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#667eea');
      gradient.addColorStop(1, '#764ba2');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Add decorative border
      ctx.strokeStyle = '#ffd700';
      ctx.lineWidth = 10;
      ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

      // Inner border
      ctx.strokeStyle = 'rgba(255, 215, 0, 0.5)';
      ctx.lineWidth = 2;
      ctx.strokeRect(35, 35, canvas.width - 70, canvas.height - 70);

      // Title
      ctx.fillStyle = '#ffd700';
      ctx.font = 'bold 48px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('ржИржж ржорзБржмрж╛рж░ржХ', canvas.width / 2, 100);

      // Moon and stars decoration
      ctx.font = '60px Arial';
      ctx.fillText('ЁЯМЩтЬи', canvas.width / 2, 170);

      // Recipient name
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 36px Arial';
      ctx.fillText(currentUserName + ' ржХрзЗ', canvas.width / 2, 250);

      // Salami message
      ctx.font = '28px Arial';
      ctx.fillText('рж╕рж╛рж▓рж╛ржорзАрж░ рж╢рзБржнрзЗржЪрзНржЫрж╛', canvas.width / 2, 300);

      // Load and draw bill image
      if (currentBillImage) {
        try {
          const img = new Image();
          img.crossOrigin = 'anonymous';
          await new Promise((resolve, reject) => {
            img.onload = resolve;
            img.onerror = reject;
            img.src = currentBillImage;
          });
          
          const imgWidth = 400;
          const imgHeight = (img.height / img.width) * imgWidth;
          ctx.drawImage(img, (canvas.width - imgWidth) / 2, 350, imgWidth, imgHeight);
        } catch (e) {
          console.error('Error loading bill image:', e);
        }
      }

      // Duwa section
      ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';
      ctx.fillRect(60, 650, canvas.width - 120, 400);
      
      ctx.strokeStyle = '#ffd700';
      ctx.lineWidth = 3;
      ctx.strokeRect(60, 650, canvas.width - 120, 400);

      // Duwa title
      ctx.fillStyle = '#ffd700';
      ctx.font = 'bold 28px Arial';
      ctx.fillText('ржжрзЛржпрж╝рж╛', canvas.width / 2, 700);

      // Arabic text
      if (currentDuwa) {
        ctx.fillStyle = '#ffffff';
        ctx.font = '24px Arial';
        ctx.textAlign = 'center';
        
        // Wrap Arabic text
        const arabicLines = wrapText(ctx, currentDuwa.arabic, canvas.width - 160);
        let yPos = 750;
        arabicLines.forEach(line => {
          ctx.fillText(line, canvas.width / 2, yPos);
          yPos += 35;
        });

        // Bengali translation
        ctx.font = '20px Arial';
        yPos += 20;
        const banglaLines = wrapText(ctx, currentDuwa.bangla, canvas.width - 160);
        banglaLines.forEach(line => {
          ctx.fillText(line, canvas.width / 2, yPos);
          yPos += 30;
        });
      }

      // Footer
      ctx.fillStyle = '#ffd700';
      ctx.font = '18px Arial';
      ctx.fillText('From: Aunik & Mahdi', canvas.width / 2, canvas.height - 80);
      ctx.font = '16px Arial';
      ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
      ctx.fillText('Generated on ' + new Date().toLocaleDateString('bn-BD'), canvas.width / 2, canvas.height - 50);

      return canvas;
    }

    // Helper function to wrap text
    function wrapText(ctx, text, maxWidth) {
      const words = text.split(' ');
      const lines = [];
      let currentLine = words[0];

      for (let i = 1; i < words.length; i++) {
        const word = words[i];
        const width = ctx.measureText(currentLine + ' ' + word).width;
        if (width < maxWidth) {
          currentLine += ' ' + word;
        } else {
          lines.push(currentLine);
          currentLine = word;
        }
      }
      lines.push(currentLine);
      return lines;
    }

    // Download card as image
    async function downloadCard() {
      const btn = document.getElementById('downloadBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> рждрзИрж░рж┐ рж╣ржЪрзНржЫрзЗ...';

      try {
        const canvas = await generateDownloadCard();
        
        // Convert to blob and download
        canvas.toBlob(blob => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `eid-salami-${currentUserName}-${Date.now()}.png`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          btn.disabled = false;
          btn.innerHTML = 'ЁЯУе ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи';
        }, 'image/png');

      } catch (error) {
        console.error('Download error:', error);
        showError('ржбрж╛ржЙржирж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗ');
        btn.disabled = false;
        btn.innerHTML = 'ЁЯУе ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи';
      }
    }

    // Main receive button
    document.getElementById("receiveBtn").addEventListener("click", async function() {
      const userName = document.getElementById("userName").value;

      // Validate input
      const validation = validateName(userName);
      if (!validation.valid) {
        showError(validation.error);
        return;
      }

      // Disable button while processing
      this.disabled = true;
      this.innerHTML = '<span class="loading"></span> ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ржХрж░ржг...';

      // Save current user name
      currentUserName = userName.trim();

      // Save to server (replace with your Netlify function call)
      const saved = await saveSalami(userName);

      if (!saved) {
        this.disabled = false;
        this.innerHTML = 'ЁЯОЙ рж╕рж╛рж▓рж╛ржорзА ржирж┐ржи';
        return;
      }

      // Display message
      const message = escapeHtml(userName.trim()) + ", ржПржЗ ржирж╛ржУ рждрзЛржорж╛рж░ рж╕рж╛рж▓рж╛ржорзА! ЁЯОБЁЯТ░";
      document.getElementById("resultMessage").innerHTML = message;

      // Random bill
      const randomIndex = Math.floor(Math.random() * billImages.length);
      currentBillImage = billImages[randomIndex];
      document.getElementById("billImage").src = currentBillImage;

      // Random duwa
      const duwaIndex = Math.floor(Math.random() * duwaCollection.length);
      currentDuwa = duwaCollection[duwaIndex];
      document.getElementById("duwaArabic").textContent = currentDuwa.arabic;
      document.getElementById("duwaBangla").textContent = currentDuwa.bangla;

      // Show recipient number
      document.getElementById("counter").innerHTML = 
        `ЁЯМЯ ржЖржкржирж┐ ржкрзНрж░рж╛ржкржХ ржиржВ рзз ЁЯМЯ`;

      // Show result
      document.getElementById("initialContainer").style.display = "none";
      document.getElementById("resultContainer").classList.remove("hidden");

      // Confetti effect
      createConfetti();

      // Re-enable button
      this.disabled = false;
      this.innerHTML = 'ЁЯОЙ рж╕рж╛рж▓рж╛ржорзА ржирж┐ржи';
    });

    // Download button
    document.getElementById("downloadBtn").addEventListener("click", downloadCard);

    // Try again button
    document.getElementById("tryAgainBtn").addEventListener("click", function() {
      document.getElementById("userName").value = "";
      document.getElementById("resultContainer").classList.add("hidden");
      document.getElementById("initialContainer").style.display = "block";
      loadHistory();
    });

    // Share button
    document.getElementById("shareBtn").addEventListener("click", async function() {
      const shareText = `${currentUserName} ржИржжрзЗрж░ рж╕рж╛рж▓рж╛ржорзА ржкрзЗржпрж╝рзЗржЫрзЗржи! ЁЯОБЁЯТ░\n\nржПржЗ ржирж╛ржУ рждрзЛржорж╛рж░ рж╕рж╛рж▓рж╛ржорзА:\n${currentDuwa.bangla}\n\n- Aunik & Mahdi`;
      
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'ржИржж рж╕рж╛рж▓рж╛ржорзА',
            text: shareText,
            url: window.location.href
          });
        } catch (err) {
          if (err.name !== 'AbortError') {
            console.log('Share cancelled');
          }
        }
      } else {
        // Fallback: copy to clipboard
        try {
          await navigator.clipboard.writeText(shareText + '\n\n' + window.location.href);
          alert('рж▓рж┐ржВржХ ржХржкрж┐ рж╣ржпрж╝рзЗржЫрзЗ! ЁЯУЛ');
        } catch (err) {
          showError('рж╢рзЗржпрж╝рж╛рж░ ржХрж░рждрзЗ ржмрзНржпрж░рзНрже ЁЯШФ');
        }
      }
    });

    // Enter key support
    document.getElementById("userName").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        document.getElementById("receiveBtn").click();
      }
    });

    // Load history on start
    loadHistory();
  </script>

</body>
</html>